<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personnages</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="{{ url_for('static', filename='js/gallery-scroller.js') }}"></script>
</head>
<body class="bg-gray-100 text-gray-800">

    {% include 'navbar.html' %}
    
    <div class="max-w-7xl mx-auto mt-10 p-6 bg-white shadow-lg rounded-lg">
        <h1 class="text-2xl font-semibold text-center mb-6">Liste des Personnages</h1>

        <!-- Bouton Ajouter une image -->
        <div class="text-center mb-6">
            <a href="/upload_poster" class="bg-blue-600 text-white px-4 py-2 rounded-md shadow-md font-medium hover:bg-blue-700 transition">
                Ajouter une image
            </a>
        </div>

        <!-- Filtres de recherche -->
        <div class="flex flex-col md:flex-row justify-center items-center space-x-4 space-y-2 md:space-y-0 mb-6">
            <div class="flex items-center">
                <input type="checkbox" id="allow-inverted-ratio" class="mr-2">
                <label for="allow-inverted-ratio" class="font-medium">Inclure les ratios inversés</label>
            </div>

            <div class="flex items-center space-x-2">
                <label for="ratio-input" class="font-medium">Chercher par ratio :</label>
                <input type="number" id="ratio-input" step="0.01" class="border p-2 rounded-md shadow-sm">
                <button onclick="filterByRatio()" class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition">
                    Rechercher
                </button>
            </div>
        </div>

        <!-- Nouveau système de galerie avec scroll avancé -->
        <div class="gallery-container relative select-none">
            <!-- Navigation -->
            <div class="gallery-navigation">
                <button id="prev-btn" class="gallery-nav-btn left-0 opacity-80 hover:opacity-100">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                        <path fill-rule="evenodd" d="M7.72 12.53a.75.75 0 010-1.06l7.5-7.5a.75.75 0 111.06 1.06L9.31 12l6.97 6.97a.75.75 0 11-1.06 1.06l-7.5-7.5z" clip-rule="evenodd" />
                    </svg>
                </button>
                <button id="next-btn" class="gallery-nav-btn right-0 opacity-80 hover:opacity-100">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                        <path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 01-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 011.06-1.06l7.5 7.5z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>

            <!-- Conteneur de scroll avec track et progressbar -->
            <div class="gallery-scrollbar">
                <div class="gallery-scrollbar-track"></div>
                <div class="gallery-scrollbar-thumb"></div>
            </div>

            <!-- Conteneur des cartes -->
            <div class="gallery-wrapper">
                <div id="gallery-track" class="gallery-track">
                {% for row in data %}
                    <div class="gallery-item" data-ratio="{{ row[1] }}" data-width="{{ row[2] }}" data-height="{{ row[3] }}">
                        <div class="gallery-card">
                            <img src="{{ url_for('static', filename='images/' + row[4]) }}" class="gallery-img" alt="{{ row[0] }}">
                            <div class="gallery-content">
                                <h3 class="text-base font-semibold">{{ row[0] }}</h3>
                                <p class="text-xs text-gray-600">Ratio: {{ row[1] }}</p>
                                <p class="text-xs text-gray-600">Dim: {{ row[2] }}x{{ row[3] }}</p>
                                <form class="mt-1" action="/delete_poster/{{ row[5] }}" method="post" onsubmit="return confirm('Voulez-vous vraiment supprimer cette image ?');">
                                    <input type="hidden" name="_method" value="DELETE">
                                    <button type="submit" class="text-red-600 hover:text-red-800 transition text-lg font-bold">
                                        &times;
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                {% endfor %}
                </div>
            </div>

            <!-- Indicateurs de pagination (points) -->
            <div class="gallery-pagination"></div>
        </div>
    </div>

    <!-- Styles pour la nouvelle galerie -->
    <style>
        /* Conteneur principal de la galerie */
        .gallery-container {
            width: 100%;
            position: relative;
            padding: 2rem 0;
            user-select: none;
        }

        /* Wrapper pour contenir la track */
        .gallery-wrapper {
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        /* Track qui contient les éléments de la galerie */
        .gallery-track {
            display: flex;
            transition: transform 0.5s cubic-bezier(0.15, 0.3, 0.25, 1);
            will-change: transform;
        }

        /* Élément individuel de la galerie */
        .gallery-item {
            flex: 0 0 calc(25% - 1rem);
            margin: 0 0.5rem;
            cursor: grab;
        }

        @media (max-width: 1024px) {
            .gallery-item {
                flex: 0 0 calc(33.333% - 1rem);
            }
        }

        @media (max-width: 768px) {
            .gallery-item {
                flex: 0 0 calc(50% - 1rem);
            }
        }

        @media (max-width: 480px) {
            .gallery-item {
                flex: 0 0 calc(100% - 1rem);
            }
        }

        /* Carte d'élément de galerie */
        .gallery-card {
            background-color: white;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            height: 100%;
            transition: transform 0.2s;
        }

        .gallery-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Image dans la carte */
        .gallery-img {
            width: 100%;
            height: 160px;
            object-fit: cover;
        }

        /* Contenu de la carte */
        .gallery-content {
            padding: 1rem;
        }

        /* Navigation de la galerie */
        .gallery-nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            background-color: rgba(255, 255, 255, 0.9);
            color: #4B5563;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
            transition: all 0.3s;
        }

        .gallery-nav-btn:hover {
            background-color: white;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);
        }

        .gallery-nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Scrollbar personnalisée */
        .gallery-scrollbar {
            position: relative;
            height: 6px;
            margin: 1rem 0;
            width: 100%;
            cursor: pointer;
        }

        .gallery-scrollbar-track {
            position: absolute;
            height: 100%;
            width: 100%;
            background-color: #E5E7EB;
            border-radius: 3px;
        }

        .gallery-scrollbar-thumb {
            position: absolute;
            height: 100%;
            background-color: #6B7280;
            border-radius: 3px;
            transition: width 0.3s, left 0.3s;
        }

        /* Pagination */
        .gallery-pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 1rem;
        }

        .pagination-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #D1D5DB;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }

        .pagination-dot.active {
            background-color: #4B5563;
            transform: scale(1.5);
        }

        /* État actif */
        .gallery-item.active .gallery-card {
            border: 2px solid #3B82F6;
        }

        /* État de grab */
        .grabbing {
            cursor: grabbing !important;
        }
        .grabbing .gallery-card {
            transform: scale(0.98);
        }
    </style>

    <script>
        // Fonction pour filtrer par ratio
        function filterByRatio() {
            let inputRatio = parseFloat(document.getElementById("ratio-input").value);
            let allowInverted = document.getElementById("allow-inverted-ratio").checked;
            let items = document.querySelectorAll(".gallery-item");
            
            // Utiliser la fonction du fichier externe
            filterGalleryByRatio(inputRatio, allowInverted, items, gallery);
        }

        // Initialiser la galerie quand le DOM est chargé
        document.addEventListener('DOMContentLoaded', function() {
            // Initialiser la galerie avec la classe importée
            const gallery = new GalleryScroller({
                track: document.getElementById('gallery-track'),
                wrapper: document.querySelector('.gallery-wrapper'),
                prevBtn: document.getElementById('prev-btn'),
                nextBtn: document.getElementById('next-btn'),
                scrollbarThumb: document.querySelector('.gallery-scrollbar-thumb'),
                scrollbarTrack: document.querySelector('.gallery-scrollbar-track'),
                paginationContainer: document.querySelector('.gallery-pagination')
            });
            
            // Exposer la galerie au scope global pour y accéder depuis filterByRatio
            window.gallery = gallery;
        });
    </script>
</body>
</html>
